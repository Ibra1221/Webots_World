#VRML_SIM R2022b utf8

EXTERNPROTO "https://raw.githubusercontent.com/cyberbotics/webots/R2022b/projects/objects/backgrounds/protos/TexturedBackground.proto"
EXTERNPROTO "https://raw.githubusercontent.com/cyberbotics/webots/R2022b/projects/objects/backgrounds/protos/TexturedBackgroundLight.proto"
EXTERNPROTO "https://raw.githubusercontent.com/cyberbotics/webots/R2022b/projects/objects/floors/protos/CircleArena.proto"
EXTERNPROTO "https://raw.githubusercontent.com/cyberbotics/webots/R2025a/projects/devices/multisense/protos/MultiSenseS21.proto"

WorldInfo { }
Viewpoint {
  orientation -0.33 -0.0987 0.938 3.686
  position 2 1.2 2
  follow "my_robot"
}
TexturedBackground { }
TexturedBackgroundLight { }
CircleArena { }

Robot {
  name "my_robot"
  controller "<extern>"

  children [
    # Left Wheel
    HingeJoint {
      jointParameters HingeJointParameters {
        axis 0 1 0
        anchor 0 0 0.05
      }
      device [
        RotationalMotor { name "left wheel motor" }
        PositionSensor { name "left wheel sensor" }
      ]
      endPoint Solid {
        translation 0 0.09 0.05
        children [
          DEF WHEEL Transform {
            rotation 1 0 0 1.5708
            children [
              Shape {
                appearance PBRAppearance {
                  baseColor 1 0 0
                  roughness 1
                  metalness 0
                }
                geometry Cylinder {
                  height 0.02
                  radius 0.05
                }
              }
            ]
          }
        ]
        name "left wheel"
        boundingObject USE WHEEL
        physics Physics {
          mass 0.5
          friction 1
        }
      }
    }

    # Right Wheel
    HingeJoint {
      jointParameters HingeJointParameters {
        axis 0 1 0
        anchor 0 0 0.05
      }
      device [
        RotationalMotor { name "right wheel motor" }
        PositionSensor { name "right wheel sensor" }
      ]
      endPoint Solid {
        translation 0 -0.09 0.05
        children [ USE WHEEL ]
        name "right wheel"
        boundingObject USE WHEEL
        physics Physics {
          mass 0.5
          friction 1
        }
      }
    }

    # Body
    Transform {
      translation 0 0 0.083
      children [
        Shape {
          appearance PBRAppearance {
            baseColor 0 0 1
            roughness 1
            metalness 0
          }
          geometry DEF BODY Cylinder {
            height 0.16
            radius 0.09
          }
        }
      ]
    }

    # Distance Sensors - IMPROVED PLACEMENT
    DistanceSensor {
      translation 0.095 0.04 0.06  # Lower and more forward
      rotation 0 0 1 0.3  # Less angle (17 degrees)
      children [
        DEF SENSOR Transform {
          rotation 0 1 0 1.5708
          children [
            Shape {
              appearance PBRAppearance {
                baseColor 1 1 0
                roughness 1
                metalness 0
              }
              geometry Cylinder { height 0.008 radius 0.016 }
            }
          ]
        }
      ]
      name "ds0"
      lookupTable [0 1024 0 0.01 1024 0 0.8 0 0]  # Longer range
      numberOfRays 4  # More rays for better detection
      aperture 0.5
    }

    DistanceSensor {
      translation 0.095 -0.04 0.06  # Lower and more forward
      rotation 0 0 1 -0.3  # Less angle (17 degrees)
      children [ USE SENSOR ]
      name "ds1"
      lookupTable [0 1024 0 0.01 1024 0 0.8 0 0]  # Longer range
      numberOfRays 4  # More rays for better detection
      aperture 0.5
    }

    # RangeFinder (Depth Camera)
    RangeFinder {
      name "rangefinder"
      translation 0.05 0 0.12
      rotation 0 1 0 0
      children [
        Transform {
          children [
            Shape {
              appearance PBRAppearance {
                baseColor 0.3 0.3 0.3
                roughness 1
                metalness 0
              }
              geometry Box { size 0.02 0.06 0.01 }
            }
          ]
        }
      ]
      width 640
      height 480
      near 0.1
      far 5.0
    }

    # Left Camera (Stereo)
    Camera {
      name "camera_left"
      translation 0.05 0.0375 0.12
      rotation 0 1 0 0
      children [
        Transform {
          children [
            Shape {
              appearance PBRAppearance {
                baseColor 0.2 0.2 0.2
                roughness 1
                metalness 0
              }
              geometry Box { size 0.01 0.01 0.01 }
            }
          ]
        }
      ]
      fieldOfView 1.0472
      width 1280
      height 800
      far 10
    }

    # Right Camera (Stereo)
    Camera {
      name "camera_right"
      translation 0.05 -0.0375 0.12
      rotation 0 1 0 0
      children [
        Transform {
          children [
            Shape {
              appearance PBRAppearance {
                baseColor 0.2 0.2 0.2
                roughness 1
                metalness 0
              }
              geometry Box { size 0.01 0.01 0.01 }
            }
          ]
        }
      ]
      fieldOfView 1.0472
      width 1280
      height 800
      far 10
    }

    # IMU, Gyro, Accelerometer
    InertialUnit { name "imu" translation 0 0 0.16 rotation 0 1 0 0 }
    Gyro { name "gyro" translation 0 0 0.16 }
    Accelerometer { name "accelerometer" translation 0 0 0.16 }

    # Lidar
    Lidar {
      translation 0 0 0.18
      rotation 0 0 1 0
      children [
        Transform {
          rotation 0 1 0 1.5708
          children [
            Shape {
              appearance PBRAppearance {
                baseColor 0 1 0
                roughness 1
                metalness 0
              }
              geometry Cylinder { height 0.02 radius 0.02 }
            }
          ]
        }
      ]
      name "lidar"
      horizontalResolution 512
      fieldOfView 6.28
      verticalFieldOfView 0.1
      numberOfLayers 1
      minRange 0.1
      maxRange 5.0
    }
  ]

  # Robot bounding object
  boundingObject Transform {
    translation 0 0 0.083
    children [ USE BODY ]
  }

  physics Physics {
    mass 2.5
  }
}